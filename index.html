<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knoxville Restaurants</title>
    <script>
        // Prevent dark mode flash of unstyled content (FOUC)
        (function() {
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark');
            }
        })();
    </script>
    <style>
        /* Preload critical fonts - copied from Cortex */
        @font-face {
            font-family: 'Serrif VF';
            src: url('fonts/SerrifVF.woff2') format('woff2-variations'),
                 url('fonts/SerrifVF.woff2') format('woff2');
            font-weight: 100 900;
            font-style: normal;
            font-display: swap;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
        }

        @font-face {
            font-family: 'Saans VF';
            src: url('fonts/SaansVF.woff2') format('woff2-variations'),
                 url('fonts/SaansVF.woff2') format('woff2');
            font-weight: 100 900;
            font-style: normal;
            font-display: swap;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --stone-50: #fafaf9;
            --stone-100: #f5f5f4;
            --stone-200: #e7e5e4;
            --stone-300: #d6d3d1;
            --stone-400: #a8a29e;
            --stone-500: #78716c;
            --stone-600: #57534e;
            --stone-700: #44403c;
            --stone-800: #292524;
            --stone-900: #1c1917;
            --stone-950: #0c0a09;
            --sienna-400: #f0a27e;
            --sienna-500: #e87f52;
            --sienna-600: #c6613f;
            --orange-200: #fed7aa;
            --orange-500: #f97316;
            --orange-900: #7c2d12;
            --amber-700: #b45309;
            --blue-600: #2563eb;
            --purple-600: #9333ea;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--stone-50);
            color: var(--stone-900);
            line-height: 1.6;
            min-height: 100vh;
        }
        body.dark { background: var(--stone-950); color: var(--stone-100); }

        .container { display: flex; flex-direction: column; height: 100vh; }

        /* Header */
        .header {
            flex-shrink: 0;
            background: white;
            border-bottom: 1px solid var(--stone-200);
            padding: 1.25rem 1rem;
        }
        body.dark .header { background: var(--stone-900); border-color: var(--stone-800); }

        .header-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.75rem; }

        h1 { font-size: 1.5rem; font-weight: 600; color: var(--stone-900); margin-bottom: 0.25rem; }
        body.dark h1 { color: var(--stone-100); }

        .stats { font-size: 0.875rem; color: var(--stone-500); }
        body.dark .stats { color: var(--stone-400); }

        .theme-btn, .export-btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            background: white;
            border: 1px solid var(--stone-300);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--stone-700);
        }
        .theme-btn:hover, .export-btn:hover { background: var(--stone-50); }
        body.dark .theme-btn, body.dark .export-btn { background: var(--stone-900); border-color: var(--stone-700); color: var(--stone-300); }
        body.dark .theme-btn:hover, body.dark .export-btn:hover { background: var(--stone-800); }

        .header-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Filters */
        .filters-wrapper { display: flex; flex-direction: column; gap: 1rem; }
        .search-wrapper { position: relative; width: 100%; max-width: 28rem; }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1rem;
            height: 1rem;
            color: var(--stone-400);
        }

        .search-input {
            width: 100%;
            height: 2.75rem;
            padding: 0 1rem 0 2.5rem;
            font-size: 0.875rem;
            background: white;
            border: 1px solid var(--stone-300);
            border-radius: 9999px;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
            outline: none;
            transition: all 0.2s;
            color: var(--stone-900);
        }
        .search-input:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .search-input:focus { border-color: transparent; box-shadow: 0 0 0 2px var(--sienna-400); }
        body.dark .search-input { background: var(--stone-900); border-color: var(--stone-700); color: var(--stone-100); }
        body.dark .search-input:focus { box-shadow: 0 0 0 2px var(--sienna-500); }

        .filter-row { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.75rem; }
        .select-group { display: flex; flex-wrap: wrap; gap: 0.5rem; }

        select {
            height: 2.75rem;
            padding: 0 2rem 0 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            background: white;
            border: 1px solid var(--stone-300);
            border-radius: 0.75rem;
            cursor: pointer;
            outline: none;
            transition: border-color 0.2s;
            color: var(--stone-900);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23a8a29e' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
        }
        select:hover { border-color: var(--sienna-400); }
        body.dark select { background: var(--stone-900); border-color: var(--stone-700); color: var(--stone-100); }

        .quick-filters { display: flex; gap: 0.5rem; align-items: center; }

        .quick-filter {
            height: 2.75rem;
            padding: 0 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            background: white;
            border: 1px solid var(--stone-300);
            border-radius: 9999px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            color: var(--stone-700);
        }
        body.dark .quick-filter { background: var(--stone-900); border-color: var(--stone-700); color: var(--stone-300); }
        .quick-filter.active-new { background: var(--orange-500); color: white; border-color: var(--orange-500); }
        .quick-filter.active-coffee { background: var(--amber-700); color: white; border-color: var(--amber-700); }

        .clear-btn {
            font-size: 0.875rem;
            color: var(--stone-600);
            text-decoration: underline;
            text-underline-offset: 4px;
            cursor: pointer;
            background: none;
            border: none;
        }
        .clear-btn:hover { color: var(--stone-900); }
        body.dark .clear-btn { color: var(--stone-400); }
        body.dark .clear-btn:hover { color: var(--stone-100); }
        .clear-btn.hidden { display: none; }

        /* Search Highlighting */
        mark {
            background: var(--amber-200);
            color: var(--stone-900);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }
        body.dark mark {
            background: var(--amber-700);
            color: white;
        }

        /* Filter Chips */
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .filter-chips.hidden { display: none; }

        .filter-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
            background: var(--stone-100);
            border: 1px solid var(--stone-300);
            border-radius: 9999px;
            color: var(--stone-700);
        }
        body.dark .filter-chip {
            background: var(--stone-800);
            border-color: var(--stone-700);
            color: var(--stone-300);
        }

        .filter-chip-remove {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1rem;
            height: 1rem;
            margin-left: 0.25rem;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            color: var(--stone-500);
            transition: color 0.15s;
        }
        .filter-chip-remove:hover {
            color: var(--stone-900);
        }
        body.dark .filter-chip-remove:hover {
            color: var(--stone-100);
        }

        /* Main Content */
        .main { flex: 1; overflow-y: auto; padding: 1.5rem; background: white; min-height: 0; }
        body.dark .main { background: var(--stone-900); }

        .loading { display: flex; justify-content: center; align-items: center; height: 24rem; }
        .loading.hidden { display: none; }

        .spinner {
            width: 2rem;
            height: 2rem;
            border: 4px solid var(--stone-200);
            border-top-color: var(--sienna-500);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        table.hidden { display: none; }

        thead {
            border-bottom: 1px solid rgba(12, 10, 9, 0.1);
        }
        body.dark thead { border-bottom-color: rgba(255, 255, 255, 0.1); }

        th {
            text-align: left;
            padding: 0.5rem 1rem;
            font-weight: 500;
            color: var(--stone-700);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        body.dark th { color: var(--stone-400); }
        th:first-child { padding-left: 0.5rem; }
        th:last-child { padding-right: 0.5rem; }

        th button {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0;
            cursor: pointer;
            background: none;
            border: none;
            color: inherit;
            font: inherit;
            transition: color 0.2s;
        }
        th button:hover { color: var(--stone-950); }
        body.dark th button:hover { color: white; }

        tbody tr {
            position: relative;
        }

        tbody tr:nth-child(even) {
            background: rgba(12, 10, 9, 0.025);
        }
        body.dark tbody tr:nth-child(even) { background: rgba(255, 255, 255, 0.025); }

        tbody tr:hover {
            background: rgba(12, 10, 9, 0.05);
        }
        body.dark tbody tr:hover { background: rgba(255, 255, 255, 0.05); }

        td {
            position: relative;
            padding: 1rem;
            color: var(--stone-500);
            border-bottom: 1px solid rgba(12, 10, 9, 0.05);
        }
        body.dark td { color: var(--stone-400); border-bottom-color: rgba(255, 255, 255, 0.05); }
        td:first-child { padding-left: 0.5rem; }
        td:last-child { padding-right: 0.5rem; }

        .restaurant-name {
            color: var(--stone-950);
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s;
        }
        .restaurant-name:hover { color: var(--sienna-600); }
        body.dark .restaurant-name { color: white; }
        body.dark .restaurant-name:hover { color: var(--sienna-400); }

        .badge {
            display: inline-block;
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .badge-new { background: var(--orange-200); color: var(--orange-900); }
        .badge-price-1 { background: var(--stone-100); color: var(--stone-700); }
        .badge-price-2 { background: #dbeafe; color: var(--blue-600); }
        .badge-price-3 { background: #fef3c7; color: var(--amber-700); }
        .badge-price-4 { background: #f3e8ff; color: var(--purple-600); }
        body.dark .badge-price-1 { background: var(--stone-800); color: var(--stone-300); }

        .score {
            font-variant-numeric: tabular-nums;
            font-weight: 500;
            color: var(--stone-700);
        }
        body.dark .score { color: var(--stone-300); }

        .tag {
            display: inline-block;
            padding: 0.125rem 0.375rem;
            margin: 0.125rem;
            background: var(--stone-100);
            border-radius: 0.25rem;
            font-size: 0.75rem;
            color: var(--stone-600);
        }
        body.dark .tag { background: var(--stone-800); color: var(--stone-400); }

        .highlights {
            font-size: 0.75rem;
            color: var(--stone-500);
            margin-top: 0.25rem;
            max-width: 32rem;
        }
        body.dark .highlights { color: var(--stone-400); }

        /* Modal - Catalyst Dialog Style */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1000;
        }
        .modal.active {
            display: block;
            animation: fadeIn 100ms ease-out;
        }
        .modal.active .modal-content {
            animation: slideUp 100ms ease-out;
        }

        /* Fade-in animation for modal */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(3rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal.active .modal-backdrop {
            animation: fadeIn 100ms ease-out;
        }

        .modal.active .modal-content {
            animation: slideUp 100ms ease-out;
        }

        @media (min-width: 640px) {
            .modal.active .modal-content {
                animation: scaleIn 100ms ease-out;
            }
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(12, 10, 9, 0.25);
            display: flex;
            justify-content: center;
            overflow-y: auto;
            width: 100vw;
            padding: 0.5rem 0.5rem;
        }
        body.dark .modal-backdrop { background: rgba(12, 10, 9, 0.5); }
        @media (min-width: 640px) {
            .modal-backdrop { padding: 2rem 1.5rem; }
        }
        @media (min-width: 1024px) {
            .modal-backdrop { padding: 4rem 2rem; }
        }

        .modal-wrapper {
            position: fixed;
            inset: 0;
            overflow-y: auto;
            width: 100vw;
            padding-top: 1.5rem;
        }
        @media (min-width: 640px) {
            .modal-wrapper { padding-top: 0; }
        }

        .modal-grid {
            display: grid;
            grid-template-rows: 1fr auto;
            justify-items: center;
            min-height: 100%;
            padding: 1rem;
        }
        @media (min-width: 640px) {
            .modal-grid { grid-template-rows: 1fr auto 1fr; }
        }

        .modal-content {
            grid-row-start: 2;
            width: 100%;
            min-width: 0;
            max-width: 64rem;
            background: white;
            border-radius: 1.5rem 1.5rem 0 0;
            padding: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(12, 10, 9, 0.1);
        }
        @media (min-width: 640px) {
            .modal-content {
                margin-bottom: auto;
                border-radius: 1rem;
            }
        }
        body.dark .modal-content {
            background: var(--stone-900);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--stone-200);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        body.dark .modal-header { border-color: var(--stone-800); }

        .modal-title {
            font-family: 'Serrif VF', 'Times New Roman', 'Times', 'Georgia', 'Cambria', 'Book Antiqua', serif;
            font-feature-settings: 'kern' 1, 'liga' 1, 'calt' 1, 'onum' 1;
            font-kerning: normal;
            font-variant-ligatures: common-ligatures contextual;
            text-rendering: optimizeLegibility;
            font-size: 1.875rem;
            font-weight: 300;
            color: var(--stone-900);
            margin-bottom: 0.75rem;
            line-height: 1.2;
        }
        body.dark .modal-title { color: var(--stone-100); }

        .modal-meta {
            font-size: 0.875rem;
            color: var(--stone-600);
            line-height: 1.5;
        }
        body.dark .modal-meta { color: var(--stone-400); }

        .modal-close {
            color: var(--stone-400);
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1.75rem;
            line-height: 1;
            padding: 0.25rem;
            transition: color 0.2s;
            flex-shrink: 0;
        }
        .modal-close:hover { color: var(--stone-600); }
        body.dark .modal-close { color: var(--stone-500); }
        body.dark .modal-close:hover { color: var(--stone-200); }

        .modal-body {
            padding: 1rem 0 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Two-column grid layout */
        .modal-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 3rem;
        }
        @media (min-width: 1024px) {
            .modal-grid {
                grid-template-columns: 2fr 3fr;
            }
        }

        .modal-column-left, .modal-column-right {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .modal-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        /* Modal text styles */
        .modal-info-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--stone-600);
            line-height: 1.5;
        }
        body.dark .modal-info-text { color: var(--stone-400); }

        .modal-section-heading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--stone-900);
            margin-bottom: 0.5rem;
        }
        body.dark .modal-section-heading { color: var(--stone-100); }

        .modal-section-text {
            font-size: 0.875rem;
            color: var(--stone-600);
            line-height: 1.6;
        }
        body.dark .modal-section-text { color: var(--stone-400); }

        .modal-description-first {
            font-size: 1rem;
            color: var(--stone-700);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }
        body.dark .modal-description-first { color: var(--stone-300); }

        .modal-description {
            font-size: 0.875rem;
            color: var(--stone-600);
            line-height: 1.6;
            margin-bottom: 0.75rem;
        }
        body.dark .modal-description { color: var(--stone-400); }

        .modal-icon {
            width: 1rem;
            height: 1rem;
            flex-shrink: 0;
        }

        .modal-link {
            color: var(--sienna-600);
            text-decoration: none;
            transition: color 0.2s;
        }
        .modal-link:hover { color: var(--sienna-700); }
        body.dark .modal-link { color: var(--sienna-400); }
        body.dark .modal-link:hover { color: var(--sienna-300); }

        .modal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .modal-tag {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            font-size: 0.75rem;
            font-weight: 500;
            background: var(--stone-100);
            color: var(--stone-700);
            border-radius: 0.375rem;
            text-transform: capitalize;
        }
        body.dark .modal-tag {
            background: var(--stone-800);
            color: var(--stone-300);
        }

        .modal-section a {
            color: var(--sienna-600);
            text-decoration: none;
            transition: text-decoration 0.2s;
        }
        .modal-section a:hover { text-decoration: underline; }
        body.dark .modal-section a { color: var(--sienna-400); }

        .modal-actions {
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--stone-200);
        }
        body.dark .modal-actions { border-color: var(--stone-800); }

        .modal-btn {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            background: var(--stone-900);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .modal-btn:hover { background: var(--stone-800); }
        body.dark .modal-btn { background: var(--stone-700); }
        body.dark .modal-btn:hover { background: var(--stone-600); }

        @media (max-width: 640px) {
            .header { padding: 1rem; }
            .main { padding: 1rem; overflow-x: auto; }
            .select-group { width: 100%; }
            select { flex: 1; min-width: 0; }
            table { min-width: 900px; }
        }

        /* Print Styles */
        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            .header {
                background: white !important;
                box-shadow: none !important;
                border-bottom: 2px solid #000;
                padding-bottom: 1rem;
            }

            .theme-btn, .export-btn, .filters-wrapper, .filter-chips, .modal-overlay, .modal {
                display: none !important;
            }

            .main {
                padding: 0 !important;
                background: white !important;
            }

            table {
                page-break-inside: avoid;
            }

            thead {
                display: table-header-group;
            }

            tr {
                page-break-inside: avoid;
            }

            td, th {
                border: 1px solid #ddd !important;
                padding: 0.5rem !important;
            }

            th {
                background: #f5f5f4 !important;
                color: #000 !important;
            }

            tbody tr:nth-child(even) {
                background: #fafaf9 !important;
            }

            a {
                text-decoration: underline;
                color: #000 !important;
            }

            a[href]:after {
                content: " (" attr(href) ")";
                font-size: 0.8em;
            }

            .stats {
                color: #000 !important;
                margin-top: 0.5rem;
            }

            h1 {
                color: #000 !important;
                font-size: 1.5rem !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-row">
                <div>
                    <h1>Knoxville Restaurants</h1>
                    <p class="stats" id="stats">Loading...</p>
                </div>
                <div class="header-actions">
                    <button class="export-btn" onclick="exportToCSV()">Export CSV</button>
                    <button class="theme-btn" onclick="toggleTheme()">Toggle Theme</button>
                </div>
            </div>

            <div class="filters-wrapper">
                <div class="search-wrapper">
                    <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input type="text" id="search" class="search-input" placeholder="Search restaurants..." aria-label="Search restaurants" role="searchbox">
                </div>

                <div class="filter-row">
                    <div class="select-group" role="group" aria-label="Restaurant filters">
                        <select id="cuisine-filter" aria-label="Filter by cuisine type">
                            <option value="">All Cuisines</option>
                        </select>
                        <select id="price-filter" aria-label="Filter by price range">
                            <option value="">All Prices</option>
                            <option value="$">$ (Under $15)</option>
                            <option value="$$">$$ ($15-25)</option>
                            <option value="$$$">$$$ ($25-40)</option>
                            <option value="$$$$">$$$$ ($40+)</option>
                        </select>
                        <select id="neighborhood-filter" aria-label="Filter by neighborhood">
                            <option value="">All Areas</option>
                        </select>
                        <select id="group-filter" aria-label="Filter by special group">
                            <option value="">All Groups</option>
                        </select>
                    </div>

                    <div class="quick-filters" role="group" aria-label="Quick filter toggles">
                        <button id="new-filter" class="quick-filter" onclick="toggleFilter('new')" aria-label="Toggle new restaurants filter" aria-pressed="false">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            New
                        </button>
                        <button id="coffee-filter" class="quick-filter" onclick="toggleFilter('coffee')" aria-label="Toggle coffee shops filter" aria-pressed="false">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4z"/></svg>
                        </button>
                        <button id="clear-filters" class="clear-btn hidden" onclick="clearFilters()" aria-label="Clear all filters">Clear</button>
                    </div>
                </div>

                <div id="filter-chips" class="filter-chips hidden"></div>
            </div>
        </div>

        <div class="main" role="main">
            <div id="loading" class="loading" role="status" aria-live="polite" aria-label="Loading restaurants">
                <div class="spinner"></div>
            </div>

            <table id="restaurants-table" class="hidden" role="table" aria-label="Restaurant directory">
                <thead>
                    <tr>
                        <th><button onclick="sortBy('name')" aria-label="Sort by restaurant name">Restaurant <span id="sort-name" aria-hidden="true"></span></button></th>
                        <th><button onclick="sortBy('cuisine_type')" aria-label="Sort by cuisine type">Cuisine <span id="sort-cuisine_type" aria-hidden="true"></span></button></th>
                        <th>Location</th>
                        <th><button onclick="sortBy('price_range')" aria-label="Sort by price range">Price <span id="sort-price_range" aria-hidden="true"></span></button></th>
                        <th><button onclick="sortBy('average_rating')" aria-label="Sort by rating">Rating <span id="sort-average_rating" aria-hidden="true"></span></button></th>
                        <th><button onclick="sortBy('date_night_score')" aria-label="Sort by date night score">Date Night <span id="sort-date_night_score" aria-hidden="true"></span></button></th>
                        <th><button onclick="sortBy('atmosphere_score')" aria-label="Sort by atmosphere score">Atmosphere <span id="sort-atmosphere_score" aria-hidden="true"></span></button></th>
                        <th><button onclick="sortBy('opening_date')" aria-label="Sort by opening date">Opened <span id="sort-opening_date" aria-hidden="true"></span></button></th>
                        <th>Tags</th>
                    </tr>
                </thead>
                <tbody id="restaurants-tbody"></tbody>
            </table>
        </div>
    </div>

    <div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-name">
        <div class="modal-wrapper">
            <div class="modal-grid">
                <div class="modal-content">
                    <div class="modal-header">
                        <div style="flex: 1;">
                            <h2 class="modal-title" id="modal-name"></h2>
                            <p class="modal-meta" id="modal-meta"></p>
                        </div>
                        <button class="modal-close" onclick="closeModal()" aria-label="Close restaurant details">&times;</button>
                    </div>
                    <div class="modal-body" id="modal-body"></div>
                    <div class="modal-actions">
                        <button class="modal-btn" onclick="closeModal()">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="restaurants-data.js"></script>
    <script>
        let allRestaurants = [];
        let filteredRestaurants = [];
        let currentSort = { column: 'name', order: 'asc' };

        document.addEventListener('DOMContentLoaded', () => {
            allRestaurants = RESTAURANTS || [];
            populateFilters();
            loadStateFromURL();
            setupEventListeners();

            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.body.classList.add('dark');
            }
        });

        function setupEventListeners() {
            document.getElementById('search').addEventListener('input', filterRestaurants);
            document.getElementById('cuisine-filter').addEventListener('change', filterRestaurants);
            document.getElementById('price-filter').addEventListener('change', filterRestaurants);
            document.getElementById('neighborhood-filter').addEventListener('change', filterRestaurants);
            document.getElementById('group-filter').addEventListener('change', filterRestaurants);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
            window.addEventListener('popstate', loadStateFromURL);
        }

        function loadStateFromURL() {
            const params = new URLSearchParams(window.location.search);

            if (params.has('q')) document.getElementById('search').value = params.get('q');
            if (params.has('cuisine')) document.getElementById('cuisine-filter').value = params.get('cuisine');
            if (params.has('price')) document.getElementById('price-filter').value = params.get('price');
            if (params.has('neighborhood')) document.getElementById('neighborhood-filter').value = params.get('neighborhood');
            if (params.has('group')) document.getElementById('group-filter').value = params.get('group');
            if (params.has('new')) {
                const btn = document.getElementById('new-filter');
                btn.dataset.active = 'true';
                btn.classList.add('active-new');
            }
            if (params.has('coffee')) {
                const btn = document.getElementById('coffee-filter');
                btn.dataset.active = 'true';
                btn.classList.add('active-coffee');
            }
            if (params.has('sort')) currentSort.column = params.get('sort');
            if (params.has('order')) currentSort.order = params.get('order');

            filterRestaurants();
            renderSortIndicators();
        }

        function saveStateToURL() {
            const params = new URLSearchParams();
            const search = document.getElementById('search').value;
            const cuisine = document.getElementById('cuisine-filter').value;
            const price = document.getElementById('price-filter').value;
            const neighborhood = document.getElementById('neighborhood-filter').value;
            const group = document.getElementById('group-filter').value;
            const showNew = document.getElementById('new-filter').dataset.active === 'true';
            const showCoffee = document.getElementById('coffee-filter').dataset.active === 'true';

            if (search) params.set('q', search);
            if (cuisine) params.set('cuisine', cuisine);
            if (price) params.set('price', price);
            if (neighborhood) params.set('neighborhood', neighborhood);
            if (group) params.set('group', group);
            if (showNew) params.set('new', '1');
            if (showCoffee) params.set('coffee', '1');
            if (currentSort.column !== 'name') params.set('sort', currentSort.column);
            if (currentSort.order !== 'asc') params.set('order', currentSort.order);

            const newURL = params.toString() ? '?' + params.toString() : window.location.pathname;
            window.history.replaceState({}, '', newURL);
        }

        function populateFilters() {
            const cuisines = [...new Set(allRestaurants.map(r => r.cuisine_type))].sort();
            const neighborhoods = [...new Set(allRestaurants.flatMap(r => (r.tags || []).filter(t => t.includes('_') && !t.startsWith('group_') && !t.startsWith('chef_') && !t.includes('dining') && !t.includes('night'))))].sort();
            const groups = [...new Set(allRestaurants.flatMap(r => (r.tags || []).filter(t => t.startsWith('group_') || t.startsWith('chef_'))))].sort();

            const cuisineFilter = document.getElementById('cuisine-filter');
            cuisines.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                cuisineFilter.appendChild(opt);
            });

            const neighborhoodFilter = document.getElementById('neighborhood-filter');
            neighborhoods.forEach(n => {
                const opt = document.createElement('option');
                opt.value = n;
                opt.textContent = n.replace(/_/g, ' ');
                neighborhoodFilter.appendChild(opt);
            });

            const groupFilter = document.getElementById('group-filter');
            groups.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g;
                opt.textContent = formatGroupName(g);
                groupFilter.appendChild(opt);
            });
        }

        function formatGroupName(tag) {
            const cleaned = tag.replace(/^(group_|chef_)/, '');
            const formatted = cleaned.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            return tag.startsWith('chef_') ? 'Chef: ' + formatted : formatted;
        }

        function toggleFilter(type) {
            const btn = document.getElementById(type + '-filter');
            const isActive = btn.dataset.active === 'true';
            btn.dataset.active = !isActive;
            btn.setAttribute('aria-pressed', !isActive);

            if (type === 'new') {
                btn.classList.toggle('active-new');
            } else if (type === 'coffee') {
                btn.classList.toggle('active-coffee');
            }

            filterRestaurants();
        }

        function exportToCSV() {
            const headers = ['Name', 'Cuisine', 'Price', 'Address', 'Phone', 'Website', 'Rating', 'Date Night', 'Opening Date'];
            const csvRows = [headers.join(',')];

            filteredRestaurants.forEach(r => {
                const row = [
                    escapeCSV(r.name),
                    escapeCSV(r.cuisine_type),
                    escapeCSV(r.price_range),
                    escapeCSV(r.address),
                    escapeCSV(r.phone || ''),
                    escapeCSV(r.website || ''),
                    r.average_rating ? r.average_rating.toFixed(1) : '',
                    r.date_night_score ? r.date_night_score.toFixed(1) : '',
                    r.opening_date || ''
                ];
                csvRows.push(row.join(','));
            });

            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', 'knoxville-restaurants-' + new Date().toISOString().split('T')[0] + '.csv');
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function escapeCSV(str) {
            if (!str) return '';
            str = String(str);
            if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                return '"' + str.replace(/"/g, '""') + '"';
            }
            return str;
        }

        function clearFilters() {
            document.getElementById('search').value = '';
            document.getElementById('cuisine-filter').value = '';
            document.getElementById('price-filter').value = '';
            document.getElementById('neighborhood-filter').value = '';
            document.getElementById('group-filter').value = '';

            ['new', 'coffee'].forEach(type => {
                const btn = document.getElementById(type + '-filter');
                btn.dataset.active = 'false';
                btn.classList.remove('active-new', 'active-coffee');
            });

            filterRestaurants();
        }

        function filterRestaurants() {
            const search = document.getElementById('search').value.toLowerCase();
            const cuisine = document.getElementById('cuisine-filter').value;
            const price = document.getElementById('price-filter').value;
            const neighborhood = document.getElementById('neighborhood-filter').value;
            const group = document.getElementById('group-filter').value;
            const showNew = document.getElementById('new-filter').dataset.active === 'true';
            const showCoffee = document.getElementById('coffee-filter').dataset.active === 'true';

            filteredRestaurants = allRestaurants.filter(r => {
                if (search && !matchesSearch(r, search)) return false;
                if (cuisine && r.cuisine_type !== cuisine) return false;
                if (price && r.price_range !== price) return false;
                if (neighborhood && !(r.tags || []).includes(neighborhood)) return false;
                if (group && !(r.tags || []).includes(group)) return false;
                if (showNew && !isNewRestaurant(r)) return false;
                if (showCoffee && !r.cuisine_type.toLowerCase().includes('coffee') && !r.cuisine_type.toLowerCase().includes('cafe')) return false;
                return true;
            });

            applySorting();
            renderRestaurants();

            const hasFilters = search || cuisine || price || neighborhood || group || showNew || showCoffee;
            document.getElementById('clear-filters').classList.toggle('hidden', !hasFilters);

            renderFilterChips(search, cuisine, price, neighborhood, group, showNew, showCoffee);
            saveStateToURL();
        }

        function renderFilterChips(search, cuisine, price, neighborhood, group, showNew, showCoffee) {
            const container = document.getElementById('filter-chips');
            const chips = [];

            if (search) {
                chips.push({ label: `Search: "${search}"`, type: 'search' });
            }
            if (cuisine) {
                chips.push({ label: `Cuisine: ${cuisine}`, type: 'cuisine' });
            }
            if (price) {
                chips.push({ label: `Price: ${price}`, type: 'price' });
            }
            if (neighborhood) {
                chips.push({ label: `Area: ${neighborhood.replace(/_/g, ' ')}`, type: 'neighborhood' });
            }
            if (group) {
                chips.push({ label: formatGroupName(group), type: 'group' });
            }
            if (showNew) {
                chips.push({ label: 'New Restaurants', type: 'new' });
            }
            if (showCoffee) {
                chips.push({ label: 'Coffee Shops', type: 'coffee' });
            }

            if (chips.length === 0) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            container.innerHTML = chips.map(chip => `
                <span class="filter-chip">
                    ${chip.label}
                    <button class="filter-chip-remove" onclick="removeFilterChip('${chip.type}')" aria-label="Remove filter">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </span>
            `).join('');
        }

        function removeFilterChip(type) {
            if (type === 'search') {
                document.getElementById('search').value = '';
            } else if (type === 'cuisine') {
                document.getElementById('cuisine-filter').value = '';
            } else if (type === 'price') {
                document.getElementById('price-filter').value = '';
            } else if (type === 'neighborhood') {
                document.getElementById('neighborhood-filter').value = '';
            } else if (type === 'group') {
                document.getElementById('group-filter').value = '';
            } else if (type === 'new') {
                const btn = document.getElementById('new-filter');
                btn.dataset.active = 'false';
                btn.classList.remove('active-new');
            } else if (type === 'coffee') {
                const btn = document.getElementById('coffee-filter');
                btn.dataset.active = 'false';
                btn.classList.remove('active-coffee');
            }
            filterRestaurants();
        }

        function normalizeText(text) {
            return text.toLowerCase().replace(/[^\w\s]/g, '');
        }

        function matchesSearch(r, search) {
            const normalizedSearch = normalizeText(search);
            return normalizeText(r.name).includes(normalizedSearch) ||
                   normalizeText(r.cuisine_type).includes(normalizedSearch) ||
                   normalizeText(r.description || '').includes(normalizedSearch) ||
                   normalizeText(r.highlights || '').includes(normalizedSearch) ||
                   (r.tags || []).some(t => normalizeText(t).includes(normalizedSearch));
        }

        function highlightText(text, search) {
            if (!search || !text) return text;

            const normalizedSearch = normalizeText(search);
            const normalizedText = normalizeText(text);
            const normalizedIndex = normalizedText.indexOf(normalizedSearch);

            if (normalizedIndex === -1) return text;

            // Find the actual start position in original text by counting characters
            let originalIndex = 0;
            let normalizedCount = 0;
            while (normalizedCount < normalizedIndex && originalIndex < text.length) {
                if (/[\w\s]/.test(text[originalIndex])) {
                    normalizedCount++;
                }
                originalIndex++;
            }

            // Find the actual end position by matching normalized characters
            let endIndex = originalIndex;
            let matchedNormalized = 0;
            while (matchedNormalized < normalizedSearch.length && endIndex < text.length) {
                if (/[\w\s]/.test(text[endIndex])) {
                    matchedNormalized++;
                }
                endIndex++;
            }

            const before = text.substring(0, originalIndex);
            const match = text.substring(originalIndex, endIndex);
            const after = text.substring(endIndex);

            return before + '<mark>' + match + '</mark>' + highlightText(after, search);
        }

        function isNewRestaurant(r) {
            if (!r.opening_date) return false;
            const openingDate = new Date(r.opening_date);
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            return openingDate > threeMonthsAgo;
        }

        function sortBy(column) {
            if (currentSort.column === column) {
                currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.order = 'asc';
            }
            applySorting();
            renderRestaurants();
            renderSortIndicators();
            saveStateToURL();
        }

        function renderSortIndicators() {
            // Clear all indicators
            ['name', 'cuisine_type', 'price_range', 'average_rating', 'date_night_score', 'atmosphere_score', 'opening_date'].forEach(col => {
                const span = document.getElementById('sort-' + col);
                if (span) span.textContent = '';
            });

            // Set current indicator
            const span = document.getElementById('sort-' + currentSort.column);
            if (span) {
                span.textContent = currentSort.order === 'asc' ? ' ↑' : ' ↓';
            }
        }

        function applySorting() {
            filteredRestaurants.sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];

                // Handle null/undefined
                if (aVal == null && bVal == null) return 0;
                if (aVal == null) return 1;
                if (bVal == null) return -1;

                // Handle dates
                if (currentSort.column === 'opening_date') {
                    aVal = new Date(aVal).getTime();
                    bVal = new Date(bVal).getTime();
                }

                // Handle strings
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return currentSort.order === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.order === 'asc' ? 1 : -1;
                return 0;
            });

            // Update sort indicators
            ['name', 'cuisine_type', 'price_range', 'average_rating', 'date_night_score', 'atmosphere_score', 'opening_date'].forEach(col => {
                const elem = document.getElementById('sort-' + col);
                if (col === currentSort.column) {
                    elem.textContent = currentSort.order === 'asc' ? '↑' : '↓';
                } else {
                    elem.textContent = '';
                }
            });
        }

        function getPriceBadgeClass(price) {
            if (price === '$') return 'badge-price-1';
            if (price === '$$') return 'badge-price-2';
            if (price === '$$$') return 'badge-price-3';
            if (price === '$$$$') return 'badge-price-4';
            return 'badge-price-1';
        }

        function formatScore(score) {
            return score ? score.toFixed(1) : '-';
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }

        function renderRestaurants() {
            document.getElementById('stats').textContent = filteredRestaurants.length + ' restaurant' + (filteredRestaurants.length !== 1 ? 's' : '');

            const loading = document.getElementById('loading');
            const table = document.getElementById('restaurants-table');
            const tbody = document.getElementById('restaurants-tbody');
            const searchTerm = document.getElementById('search').value;

            loading.classList.add('hidden');

            if (filteredRestaurants.length === 0) {
                table.classList.add('hidden');
                return;
            }

            table.classList.remove('hidden');

            tbody.innerHTML = filteredRestaurants.map((r, index) => {
                const addressParts = r.address.split(',').slice(0, 2).join(',');
                const displayTags = (r.tags || []).filter(t => !t.startsWith('group_') && !t.startsWith('chef_')).slice(0, 3);

                return '<tr>' +
                    '<td>' +
                        '<div class="restaurant-name" onclick="showRestaurantByIndex(' + index + ')">' +
                            highlightText(r.name, searchTerm) +
                            (isNewRestaurant(r) ? ' <span class="badge badge-new">New</span>' : '') +
                        '</div>' +
                        (r.highlights ? '<div class="highlights">' + highlightText(r.highlights, searchTerm) + '</div>' : '') +
                    '</td>' +
                    '<td>' + highlightText(r.cuisine_type, searchTerm) + '</td>' +
                    '<td>' + addressParts + '</td>' +
                    '<td><span class="badge ' + getPriceBadgeClass(r.price_range) + '">' + r.price_range + '</span></td>' +
                    '<td><span class="score">' + formatScore(r.average_rating) + '</span></td>' +
                    '<td><span class="score">' + formatScore(r.date_night_score) + '</span></td>' +
                    '<td><span class="score">' + formatScore(r.atmosphere_score) + '</span></td>' +
                    '<td>' + formatDate(r.opening_date) + '</td>' +
                    '<td>' + displayTags.map(t => '<span class="tag">' + t.replace(/_/g, ' ') + '</span>').join(' ') + '</td>' +
                '</tr>';
            }).join('');
        }

        function showRestaurantByIndex(index) {
            const r = filteredRestaurants[index];
            if (!r) return;

            document.getElementById('modal-name').textContent = r.name;

            // Build metadata line with scores
            let meta = r.cuisine_type + ' · ' + r.price_range;
            if (r.average_rating) meta += ' · ' + r.average_rating.toFixed(1) + '/10 avg';
            if (r.date_night_score) meta += ' · ' + r.date_night_score.toFixed(1) + ' date night';
            if (r.atmosphere_score) meta += ' · ' + r.atmosphere_score.toFixed(1) + ' atmosphere';
            document.getElementById('modal-meta').textContent = meta;

            // Two-column layout
            let body = '<div class="modal-grid">';

            // LEFT COLUMN - Practical Info
            body += '<div class="modal-column-left">';

            // Location & Contact
            body += '<div class="modal-section">';
            body += '<p class="modal-info-text">' + r.address + '</p>';
            if (r.phone) {
                body += '<p class="modal-info-text"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>';
                body += '<a href="tel:' + r.phone + '" class="modal-link">' + r.phone + '</a></p>';
            }
            if (r.website) {
                body += '<p class="modal-info-text"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>';
                body += '<a href="' + r.website + '" target="_blank" rel="noopener noreferrer" class="modal-link">Website</a></p>';
            }
            body += '</div>';

            // Parking
            if (r.parking_info) {
                body += '<div class="modal-section">';
                body += '<h3 class="modal-section-heading"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Parking</h3>';
                body += '<p class="modal-section-text">' + r.parking_info + '</p>';
                body += '</div>';
            }

            // Tags
            if (r.tags && r.tags.length > 0) {
                const displayTags = r.tags.filter(t => !t.startsWith('group_') && !t.startsWith('chef_'));
                if (displayTags.length > 0) {
                    body += '<div class="modal-section">';
                    body += '<h3 class="modal-section-heading"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg> Tags</h3>';
                    body += '<div class="modal-tags">';
                    displayTags.slice(0, 8).forEach(tag => {
                        body += '<span class="modal-tag">' + tag.replace(/_/g, ' ') + '</span>';
                    });
                    body += '</div></div>';
                }
            }

            body += '</div>'; // End left column

            // RIGHT COLUMN - Narrative Content
            body += '<div class="modal-column-right">';

            // Description
            if (r.description) {
                const paragraphs = r.description.split('\n\n').filter(p => p.trim());
                body += '<div class="modal-section">';
                paragraphs.forEach((para, idx) => {
                    body += '<p class="' + (idx === 0 ? 'modal-description-first' : 'modal-description') + '">' + para + '</p>';
                });
                body += '</div>';
            }

            // Atmosphere
            if (r.atmosphere) {
                body += '<div class="modal-section">';
                body += '<h3 class="modal-section-heading"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg> Atmosphere</h3>';
                body += '<p class="modal-section-text">' + r.atmosphere + '</p>';
                body += '</div>';
            }

            // Special Features
            if (r.special_features) {
                body += '<div class="modal-section">';
                body += '<h3 class="modal-section-heading"><svg class="modal-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg> Special Features</h3>';
                body += '<p class="modal-section-text">' + r.special_features + '</p>';
                body += '</div>';
            }

            body += '</div>'; // End right column
            body += '</div>'; // End grid

            document.getElementById('modal-body').innerHTML = body;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Close modal when clicking outside content
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal' || e.target.classList.contains('modal-wrapper') || e.target.classList.contains('modal-grid')) {
                closeModal();
            }
        });

        function toggleTheme() {
            document.body.classList.toggle('dark');
            localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
        }
    </script>
</body>
</html>
