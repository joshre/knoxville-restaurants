<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knoxville Restaurants</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        sienna: {
                            50: '#fef8f5',
                            100: '#fdf1ea',
                            200: '#faddd0',
                            300: '#f6c4aa',
                            400: '#f0a27e',
                            500: '#e87f52',
                            600: '#c6613f',
                            700: '#a14f34',
                            800: '#823f2a',
                            900: '#683223',
                            950: '#3a1b13'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        [data-theme="dark"] { color-scheme: dark; }
    </style>
</head>
<body class="bg-stone-50 dark:bg-stone-950 min-h-screen">
    <div class="flex flex-col h-screen">
        <!-- Header -->
        <div class="flex-shrink-0 bg-white border-b border-stone-200 dark:bg-stone-900 dark:border-stone-800">
            <div class="py-5 px-4 sm:px-6">
                <!-- Title Row -->
                <div class="flex flex-col gap-3 mb-4 sm:flex-row sm:justify-between sm:items-end">
                    <div>
                        <h1 class="mb-1 text-2xl font-semibold text-stone-900 dark:text-stone-100">
                            Knoxville Restaurants
                        </h1>
                        <p class="text-sm text-stone-500 dark:text-stone-400" id="stats">
                            Loading...
                        </p>
                    </div>
                    <button onclick="toggleTheme()" class="px-4 py-2 text-sm bg-white dark:bg-stone-900 border border-stone-300 dark:border-stone-700 rounded-lg hover:bg-stone-50 dark:hover:bg-stone-800 transition">
                        Toggle Theme
                    </button>
                </div>

                <!-- Search & Filters -->
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center">
                        <div class="relative w-full sm:max-w-md">
                            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <input
                                type="text"
                                id="search"
                                placeholder="Search restaurants..."
                                class="pr-4 pl-10 w-full h-11 text-sm bg-white rounded-full border shadow-sm transition-shadow hover:shadow-md focus:border-transparent focus:ring-2 focus:outline-none border-stone-300 dark:bg-stone-900 dark:border-stone-700 dark:focus:ring-sienna-500 focus:ring-sienna-400"
                            />
                        </div>
                    </div>

                    <div class="flex gap-3 flex-wrap justify-between items-center">
                        <div class="flex flex-wrap gap-2">
                            <!-- Cuisine Filter -->
                            <select id="cuisine-filter" class="h-11 rounded-xl border px-4 text-sm font-medium bg-white dark:bg-stone-900 border-stone-300 dark:border-stone-700 hover:border-sienna-400">
                                <option value="">All Cuisines</option>
                            </select>

                            <!-- Price Filter -->
                            <select id="price-filter" class="h-11 rounded-xl border px-4 text-sm font-medium bg-white dark:bg-stone-900 border-stone-300 dark:border-stone-700 hover:border-sienna-400">
                                <option value="">All Prices</option>
                                <option value="$">$ (Under $15)</option>
                                <option value="$$">$$ ($15-25)</option>
                                <option value="$$$">$$$ ($25-40)</option>
                                <option value="$$$$">$$$$ ($40+)</option>
                            </select>

                            <!-- Neighborhood Filter -->
                            <select id="neighborhood-filter" class="h-11 rounded-xl border px-4 text-sm font-medium bg-white dark:bg-stone-900 border-stone-300 dark:border-stone-700 hover:border-sienna-400">
                                <option value="">All Areas</option>
                            </select>

                            <!-- Groups Filter -->
                            <select id="group-filter" class="h-11 rounded-xl border px-4 text-sm font-medium bg-white dark:bg-stone-900 border-stone-300 dark:border-stone-700 hover:border-sienna-400">
                                <option value="">All Groups</option>
                            </select>
                        </div>

                        <div class="flex gap-2 items-center">
                            <button id="new-filter" onclick="toggleFilter('new')" class="inline-flex h-11 items-center gap-2 rounded-full border px-4 text-sm font-medium transition bg-white dark:bg-stone-900 text-stone-700 dark:text-stone-300 border-stone-300 dark:border-stone-700">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                New
                            </button>
                            <button id="coffee-filter" onclick="toggleFilter('coffee')" class="inline-flex h-11 items-center gap-2 rounded-full border px-4 text-sm font-medium transition bg-white dark:bg-stone-900 text-stone-700 dark:text-stone-300 border-stone-300 dark:border-stone-700">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4z"/></svg>
                            </button>
                            <button id="clear-filters" onclick="clearFilters()" class="text-sm text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 underline underline-offset-4 hidden">
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Restaurant Grid -->
        <div class="overflow-y-auto flex-1 p-6 min-h-0 bg-white dark:bg-stone-900">
            <div id="loading" class="flex justify-center items-center h-96">
                <svg class="animate-spin w-8 h-8 text-sienna-500" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <div id="no-results" class="hidden flex-col justify-center items-center h-96 text-stone-500">
                <svg class="mb-3 w-10 h-10 text-stone-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <p class="text-sm">No restaurants found</p>
            </div>
            <div id="restaurants" class="hidden grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="hidden fixed inset-0 bg-black/70 z-50 overflow-y-auto p-4 sm:p-8" onclick="if(event.target===this) closeModal()">
        <div class="bg-white dark:bg-stone-900 rounded-2xl max-w-4xl mx-auto my-8">
            <div class="px-6 pt-6 pb-4 border-b border-stone-200 dark:border-stone-800">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h2 id="modal-name" class="text-3xl font-light text-stone-900 dark:text-stone-100 mb-2"></h2>
                        <p id="modal-meta" class="text-sm text-stone-600 dark:text-stone-400"></p>
                    </div>
                    <button onclick="closeModal()" class="text-stone-400 hover:text-stone-600 dark:hover:text-stone-200">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="modal-body" class="p-6 max-h-[70vh] overflow-y-auto"></div>
        </div>
    </div>

    <script src="restaurants-data.js"></script>
    <script>
        let allRestaurants = [];
        let filteredRestaurants = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            allRestaurants = RESTAURANTS || [];
            populateFilters();
            filterRestaurants();
            setupEventListeners();

            // Load theme
            if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
        });

        function setupEventListeners() {
            document.getElementById('search').addEventListener('input', filterRestaurants);
            document.getElementById('cuisine-filter').addEventListener('change', filterRestaurants);
            document.getElementById('price-filter').addEventListener('change', filterRestaurants);
            document.getElementById('neighborhood-filter').addEventListener('change', filterRestaurants);
            document.getElementById('group-filter').addEventListener('change', filterRestaurants);
        }

        function populateFilters() {
            const cuisines = [...new Set(allRestaurants.map(r => r.cuisine_type))].sort();
            const neighborhoods = [...new Set(
                allRestaurants.flatMap(r => (r.tags || []).filter(t => t.includes('_') && !t.startsWith('group_') && !t.startsWith('chef_') && !t.includes('dining') && !t.includes('night')))
            )].sort();
            const groups = [...new Set(
                allRestaurants.flatMap(r => (r.tags || []).filter(t => t.startsWith('group_') || t.startsWith('chef_')))
            )].sort();

            const cuisineFilter = document.getElementById('cuisine-filter');
            cuisines.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                cuisineFilter.appendChild(opt);
            });

            const neighborhoodFilter = document.getElementById('neighborhood-filter');
            neighborhoods.forEach(n => {
                const opt = document.createElement('option');
                opt.value = n;
                opt.textContent = n.replace(/_/g, ' ');
                neighborhoodFilter.appendChild(opt);
            });

            const groupFilter = document.getElementById('group-filter');
            groups.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g;
                opt.textContent = formatGroupName(g);
                groupFilter.appendChild(opt);
            });
        }

        function formatGroupName(tag) {
            const cleaned = tag.replace(/^(group_|chef_)/, '');
            const formatted = cleaned.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            return tag.startsWith('chef_') ? `Chef: ${formatted}` : formatted;
        }

        function toggleFilter(type) {
            const btn = document.getElementById(type + '-filter');
            btn.classList.toggle('bg-orange-500', type === 'new');
            btn.classList.toggle('text-white', type === 'new');
            btn.classList.toggle('border-orange-500', type === 'new');
            btn.classList.toggle('bg-amber-700', type === 'coffee');
            btn.classList.toggle('border-amber-700', type === 'coffee');
            btn.dataset.active = btn.dataset.active === 'true' ? 'false' : 'true';
            filterRestaurants();
        }

        function clearFilters() {
            document.getElementById('search').value = '';
            document.getElementById('cuisine-filter').value = '';
            document.getElementById('price-filter').value = '';
            document.getElementById('neighborhood-filter').value = '';
            document.getElementById('group-filter').value = '';
            ['new', 'coffee'].forEach(type => {
                const btn = document.getElementById(type + '-filter');
                btn.dataset.active = 'false';
                btn.classList.remove('bg-orange-500', 'text-white', 'border-orange-500', 'bg-amber-700', 'border-amber-700');
            });
            filterRestaurants();
        }

        function filterRestaurants() {
            const search = document.getElementById('search').value.toLowerCase();
            const cuisine = document.getElementById('cuisine-filter').value;
            const price = document.getElementById('price-filter').value;
            const neighborhood = document.getElementById('neighborhood-filter').value;
            const group = document.getElementById('group-filter').value;
            const showNew = document.getElementById('new-filter').dataset.active === 'true';
            const showCoffee = document.getElementById('coffee-filter').dataset.active === 'true';

            filteredRestaurants = allRestaurants.filter(r => {
                if (search && !matchesSearch(r, search)) return false;
                if (cuisine && r.cuisine_type !== cuisine) return false;
                if (price && r.price_range !== price) return false;
                if (neighborhood && !(r.tags || []).includes(neighborhood)) return false;
                if (group && !(r.tags || []).includes(group)) return false;
                if (showNew && !isNewRestaurant(r)) return false;
                if (showCoffee && !r.cuisine_type.toLowerCase().includes('coffee') && !r.cuisine_type.toLowerCase().includes('cafe')) return false;
                return true;
            });

            renderRestaurants();

            // Show/hide clear button
            const hasFilters = search || cuisine || price || neighborhood || group || showNew || showCoffee;
            document.getElementById('clear-filters').classList.toggle('hidden', !hasFilters);
        }

        function matchesSearch(r, search) {
            return r.name.toLowerCase().includes(search) ||
                   r.cuisine_type.toLowerCase().includes(search) ||
                   (r.description || '').toLowerCase().includes(search) ||
                   (r.highlights || '').toLowerCase().includes(search) ||
                   (r.tags || []).some(t => t.toLowerCase().includes(search));
        }

        function isNewRestaurant(r) {
            if (!r.opening_date) return false;
            const openingDate = new Date(r.opening_date);
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            return openingDate > threeMonthsAgo;
        }

        function renderRestaurants() {
            document.getElementById('stats').textContent = `${filteredRestaurants.length} restaurant${filteredRestaurants.length !== 1 ? 's' : ''}`;

            const loading = document.getElementById('loading');
            const noResults = document.getElementById('no-results');
            const container = document.getElementById('restaurants');

            loading.classList.add('hidden');

            if (filteredRestaurants.length === 0) {
                noResults.classList.remove('hidden');
                noResults.classList.add('flex');
                container.classList.add('hidden');
                return;
            }

            noResults.classList.add('hidden');
            container.classList.remove('hidden');

            container.innerHTML = filteredRestaurants.map(r => `
                <div onclick='showRestaurant(${JSON.stringify(r).replace(/'/g, "\\'")})'
                     class="p-4 bg-white rounded-2xl border shadow-sm transition cursor-pointer hover:shadow-md border-stone-200 dark:border-stone-800 dark:bg-stone-900">
                    <div class="flex gap-3 justify-between items-start">
                        <div class="flex-1 min-w-0">
                            <div class="flex gap-2 items-center">
                                <span class="text-lg font-semibold text-stone-900 dark:text-stone-100">
                                    ${r.name}
                                </span>
                                ${isNewRestaurant(r) ? '<span class="px-2 py-0.5 text-xs font-medium bg-orange-200 text-orange-900 rounded">New</span>' : ''}
                            </div>
                            <div class="flex flex-wrap gap-y-1 gap-x-2 items-center mt-1 text-sm text-stone-500 dark:text-stone-400">
                                <span>${r.cuisine_type}</span>
                                <span class="text-stone-300 dark:text-stone-700">•</span>
                                <span class="truncate">${r.address.split(',').slice(0, 2).join(',')}</span>
                            </div>
                            ${r.highlights ? `<p class="mt-2 text-sm text-stone-600 dark:text-stone-300">${r.highlights}</p>` : ''}
                        </div>
                        <div class="flex flex-col gap-2 items-end">
                            ${r.average_rating ? `<span class="text-sm font-medium text-stone-700 dark:text-stone-300">${r.average_rating.toFixed(1)}/10</span>` : ''}
                            <span class="px-2 py-0.5 text-xs font-mono bg-stone-100 dark:bg-stone-800 text-stone-700 dark:text-stone-300 rounded">${r.price_range}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showRestaurant(r) {
            document.getElementById('modal-name').textContent = r.name;
            document.getElementById('modal-meta').textContent = `${r.cuisine_type} · ${r.price_range}${r.average_rating ? ` · ${r.average_rating.toFixed(1)}/10` : ''}`;

            document.getElementById('modal-body').innerHTML = `
                <div class="space-y-6">
                    <div>
                        <h3 class="text-sm font-semibold text-stone-900 dark:text-stone-100 mb-2">Address</h3>
                        <p class="text-stone-700 dark:text-stone-300">${r.address}</p>
                        ${r.phone ? `<p class="mt-1"><a href="tel:${r.phone}" class="text-sienna-600 dark:text-sienna-400 hover:underline">${r.phone}</a></p>` : ''}
                        ${r.website ? `<p class="mt-1"><a href="${r.website}" target="_blank" class="text-sienna-600 dark:text-sienna-400 hover:underline">Website →</a></p>` : ''}
                    </div>
                    ${r.description ? `
                        <div>
                            <h3 class="text-sm font-semibold text-stone-900 dark:text-stone-100 mb-2">Description</h3>
                            <p class="text-stone-700 dark:text-stone-300">${r.description}</p>
                        </div>
                    ` : ''}
                    ${r.atmosphere ? `
                        <div>
                            <h3 class="text-sm font-semibold text-stone-900 dark:text-stone-100 mb-2">Atmosphere</h3>
                            <p class="text-stone-700 dark:text-stone-300">${r.atmosphere}</p>
                        </div>
                    ` : ''}
                    ${r.special_features ? `
                        <div>
                            <h3 class="text-sm font-semibold text-stone-900 dark:text-stone-100 mb-2">Special Features</h3>
                            <p class="text-stone-700 dark:text-stone-300">${r.special_features}</p>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
        }

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        // Escape key closes modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>
</html>
